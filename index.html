<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css" />
		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css" />
		<script type="text/javascript" src="prototype.js"></script>
		<!--<script type="text/javascript" src="widgetTypes.js"></script>-->
		
		<style type="text/css">
			button {
				float: right;
				clear: none;
			}
			button.working {
				background-color: rgb(223, 117, 20);
				color: white;
			}
			input {
				float: left;
				clear: none;
			}
			input[readonly] {
				background-color: #CCCCCC;
			}
			#demo {
				text-align: center;
			}
		</style>
		<script>
			window.document.addEventListener('DOMContentLoaded', function(){
				var demoContainer = window.document.querySelector('#demo');
				
				function ActiveInactiveWidget(container){
					this.input = container.ownerDocument.createElement('input');
					this.input.setAttribute('type', 'text');
					
					var enabled = false;
					var input = this.input;
					
					function enableInput(){
						input.removeAttribute('readonly');
					}
					
					function disableInput(){
						input.setAttribute('readonly', 'readonly');
					}
					
					disableInput();
					
					this.expose('toggle', function(inputData){
						if(enabled){
							disableInput();
							enabled = false;
						}
						else{
							enableInput();
							enabled = true;
						}
					});
					
					container.appendChild(this.input);
				}
				ActiveInactiveWidget.prototype = Object.create(Widget.prototype);
				ActiveInactiveWidget.prototype.describe({
					slots: { toggle: null }
				});
				
				function ActivatorWidget(container){
					this.button = window.document.createElement('button');
					this.button.setAttribute('type', 'button');
					this.button.setAttribute('class', 'pure-button');
					this.button.appendChild(window.document.createTextNode('Unlock'));
					
					var unlocked = false;
					var working = false;
					
					var button = this.button;
					
					function startWorking(){
						button.classList.add('working');
						working = true;
					}
					
					function stopWorking(){
						button.classList.remove('working');
						working = false;
					}
					
					function toggle(event){
						if(!unlocked){
							this.button.childNodes[0].nodeValue = 'Save';
						}
						else{
							this.button.childNodes[0].nodeValue = 'Unlock';
							startWorking();
							setTimeout(stopWorking, 1000);
						}
						unlocked = !unlocked;
						event.preventDefault();
						event.stopPropagation();
						this.emit('click', {});
					}
					
					this.button.addEventListener('click', (function(event){
						toggle.call(this, event);
					}).bind(this));
					
					container.appendChild(this.button);
				}
				ActivatorWidget.prototype = Object.create(Widget.prototype);
				ActivatorWidget.prototype.describe({
					signals: { click: null }
				});
				
				
				var input = new ActiveInactiveWidget(demoContainer);
				var button = new ActivatorWidget(demoContainer);
				
				Widget.connect(button.signal('click'), input.slot('toggle'));
			});
		</script>
	</head>
	<body>
		<div class="pure-g">
			<form class="pure-form pure-u-1 pure-u-md-1-3">
				<fieldset id="demo">
					<legend>Safety input switch</legend>
				</fieldset>
			</form>
		</div>
	</body>
</html>